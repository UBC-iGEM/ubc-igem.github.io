---
import Layout from "../layouts/Layout.astro"


const images = [
  {img: 'pat.png', alt: 'the goat'},
  {img: 'guy-at-bsc.png', alt: 'guy at bsc'},
  {img: 'guy-looking-at-tubes.png', alt: 'tubes!!'},
  {img: 'igem-petri-dishes.png', alt: 'petri dish dish petri petri dish dish petri'},
]
---


<Layout title="How We Work">
  <div class="page-content">
    <div class="carousel">
      <img id="img1" src="/static/subteam-pics/pat.png" alt="pat" class="active"/>
      <div class="caption">
        <p>the goat</p>
      </div>
      <img id="img2" src="/static/subteam-pics/guy-at-bsc.png" alt="guy-at-bsc" />
      <div class="caption">
        <p>guy at bsc</p>
      </div>
      <img id="img3" src="/static/subteam-pics/guy-looking-at-tubes.png" alt="guy-looking-at-tubes" />
      <div class="caption">
        <p>guy looking at tubes</p>
      </div>
      <img id="img4" src="/static/subteam-pics/igem-petri-dishes.png" alt="igem-petri-dishes" />
      <div class="caption">
        <p>igem petri dishes</p>
      </div>
      <div class="carousel-buttons">
        <button class="prev-button">prev</button>
        <button class="next-button">next</button>
      </div>
    </div>
  </div>
</Layout>

<script>
  const handleCarouselButtonClick = (
    event: Event,
    findCurrAndNext: (carousel: Element) => Element[]
  ) => {
    const cause_button = event.target as HTMLButtonElement
    const carousel = cause_button.closest(".carousel")!

    const [currentActive, nextActive] = findCurrAndNext(carousel)

    currentActive.classList.remove("active")
    nextActive.classList.add("active")
    nextActive.scrollIntoView({block: "nearest", inline: "nearest"})
  }

  const nextButtonHandler = (event: Event) => handleCarouselButtonClick(
    event, (carousel) => {
      const curr = carousel.querySelector(".active")!
      const next = carousel.querySelector(
        ".active + .caption + img"
      ) ?? carousel.firstElementChild!
      return [curr, next]
    }
  )

  const prevButtonHandler = (event: Event) => handleCarouselButtonClick(
    event, (carousel) => {
      const curr = carousel.querySelector(".active")!
      const next = curr.previousElementSibling?.previousElementSibling
          ?? carousel.querySelector("img:last-of-type")
      return [curr, next!]
    }
  )

  document.querySelectorAll(".next-button").forEach(x => x.addEventListener("click", nextButtonHandler))
  document.querySelectorAll(".prev-button").forEach(x => x.addEventListener("click", prevButtonHandler))
</script>

<style>
  :root {
    --carousel-img-height: 400px;
  }

  .carousel {
    display: grid;
    grid-auto-flow: column;
    grid-template-rows: var(--carousel-img-height) 1fr;
    overflow-x: auto;

    margin: 10vw;
  }

  .carousel > img {
    grid-row: 1;
    height: calc(var(--carousel-img-height));
  }

  .caption {
    display: none;
  }

  .active + .caption {
    display: grid;
    grid-column: 1 / -1;
    grid-row: 2;
    position: sticky;
    left: 10px;
  }

  .carousel-buttons {
    grid-row: 2;
    justify-self: end;
    position: sticky;
    right: 10px;

    button {
      height: 64px;
      width: 64px;
    }
  }
</style>
