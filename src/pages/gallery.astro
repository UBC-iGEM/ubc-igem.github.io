---
import Layout from "../layouts/Layout.astro";
import galleryImages from "../data/gallery/images.json";

const pageTitle = "Gallery - UBC iGEM";

function distributeImagesIntoColumns(images: any[], numColumns = 4) {
  const columns = Array.from({ length: numColumns }, (_, index) => ({
    id: `column-${index + 1}`,
    images: [] as any[]
  }));
  
  images.forEach((image: any, index: number) => {
    const columnIndex = index % numColumns;
    columns[columnIndex].images.push(image);
  });
  
  return { columns };
}

const galleryData = distributeImagesIntoColumns(galleryImages);
console.log(galleryData);
---

<Layout title={pageTitle}>
  <section class="gallery-hero-section">
    <h1>Gallery</h1>
  </section>
  
  <section class="gallery-content-section">
    <div class="wrapper masonry">
      <div class="switcher">
        {galleryData.columns.map((column) => (
          <div class="flow">
            {column.images.map((image) => (
              <div class="image-container" data-alt={image.alt}>
                <img src={image.src} alt={image.alt} />
              </div>
            ))}
          </div>
        ))}
      </div>
    </div>
  </section>
</Layout>

<style>
  h1 {
    font-size: 4.5em;
    font-weight: 900;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    color: var(--color-primary-black);
  }

  .gallery-hero-section {
    background-color: var(--color-primary-green);
    padding: 5% max(10%, min(110px, 15vw));
    text-align: left;
    border-bottom: solid var(--border-width) var(--border-color);
    outline: var(--border-color);
  }

  .gallery-content-section {
    padding: 5% max(2%, min(60px, 5vw));
    min-height: 400px;
  }

  .masonry {
    --gutter: 0.75rem;
    max-width: var(--max-width);
    margin: 0 auto;
  }

  .switcher {
    display: flex;
    flex-wrap: wrap;
    gap: var(--gutter);
    align-items: flex-start;
  }

  .switcher > * {
    flex: 1 1 calc((20rem - 100%) * 999);
  }

  .flow > * + * {
    margin-top: var(--gutter);
  }

  .image-container {
    position: relative;
    border-radius: var(--border-radius-sm);
    overflow: hidden;
    transition: transform 0.2s ease;
  }

  .image-container:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .image-container img {
    width: 100%;
    height: auto;
    display: block;
    background: var(--color-secondary-green);
    min-height: 200px;
    object-fit: cover;
  }

  .image-container::after {
    content: attr(data-alt);
    position: absolute;
    bottom: 0;
    width: 100%;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    color: white;
    padding: 2rem 1rem 1rem;
    font-size: 0.9rem;
    font-weight: 500;
    line-height: 1.3;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  .image-container:hover::after {
    opacity: 1;
  }

  @media (max-width: 768px) {
    .switcher > * {
      flex-basis: calc((25rem - 100%) * 999);
    }
    
    .gallery-content-section {
      padding: 5% max(1.5%, min(20px, 3vw));
      left: 0;
      right: 0;
    }
  }
</style>
